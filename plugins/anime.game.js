// game-anime.js - Ù†Ø¸Ø§Ù… Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ù†Ù…ÙŠ
const axios = require('axios');

const animeFacts = [
  "ØºÙˆØ¬Ùˆ Ø³Ø§ØªÙˆØ±Ùˆ ÙŠÙ…ØªÙ„Ùƒ Ù‚ÙˆØ© Ø§Ù„Ù„Ø§Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ØªÙŠ ØªÙ…Ù†Ø¹ Ø£ÙŠ Ø´ÙŠØ¡ Ù…Ù† Ù„Ù…Ø³Ù‡",
  "Ø¥ÙŠØªØ§ØªØ´ÙŠ Ø£ÙˆØªØ´ÙŠÙ‡Ø§ ÙƒØ§Ù† ÙŠØ­Ù…ÙŠ Ù‚Ø±ÙŠØ© ÙƒÙˆÙ†ÙˆÙ‡Ø§ Ø³Ø±Ø§Ù‹ Ø·ÙˆØ§Ù„ Ø§Ù„ÙˆÙ‚Øª",
  "Ù„ÙˆÙÙŠ Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¬ÙŠØ± 5 Ù„Ø£ÙˆÙ„ Ù…Ø±Ø© ÙÙŠ Ù…Ø¹Ø±ÙƒØªÙ‡ Ø¶Ø¯ ÙƒØ§ÙŠØ¯Ùˆ",
  "Ø³ÙˆÙ†Øº Ø¬ÙŠÙ† ÙˆÙˆ Ø£ØµØ¨Ø­ Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„ÙˆØ­ÙŠØ¯ Ù…Ù† Ø±ØªØ¨Ø© S ÙÙŠ Ù†Ø¸Ø§Ù… Ø§Ù„Ø¸Ù„",
  "ØªØ§Ù†Ø¬ÙŠØ±Ùˆ ÙƒØ§Ù…Ø§Ø¯Ùˆ ÙŠÙ…ØªÙ„Ùƒ ØªÙ‚Ù†ÙŠØ© ØªÙ†ÙØ³ Ø§Ù„Ø´Ù…Ø³ Ø§Ù„Ø£Ù‚ÙˆÙ‰",
  "Ù„ÙŠÙØ§ÙŠ Ø£ÙƒØ±Ù…Ø§Ù† Ù‚ØªÙ„ 58 ØªÙŠØªØ§Ù† ÙÙŠ Ù…Ø¹Ø±ÙƒØ© ÙˆØ§Ø­Ø¯Ø©",
  "Ù†Ø§Ø±ÙˆØªÙˆ Ø£ÙˆØ²ÙˆÙ…Ø§ÙƒÙŠ Ø£ØµØ¨Ø­ Ù‡ÙˆÙƒØ§Ø¬ÙŠ Ø§Ù„Ø³Ø§Ø¨Ø¹",
  "Ø³Ø§ÙŠØªØ§Ù…Ø§ ÙŠØ³ØªØ·ÙŠØ¹ Ù‡Ø²ÙŠÙ…Ø© Ø£ÙŠ Ø¹Ø¯Ùˆ Ø¨Ø¶Ø±Ø¨Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø·"
];

const animeQuotes = [
  "Ø£Ù†Ø§ Ø³Ø£ØµØ¨Ø­ Ù…Ù„Ùƒ Ø§Ù„Ù‚Ø±Ø§ØµÙ†Ø©! â€” Ù„ÙˆÙÙŠ",
  "Ø§Ù„Ù‚ÙˆØ© Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ© Ù‡ÙŠ Ø­Ù…Ø§ÙŠØ© Ù…Ù† ØªØ­Ø¨ â€” Ø¥ÙŠØªØ§ØªØ´ÙŠ",
  "Ø³Ø£Ù‚Ø¶ÙŠ Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙŠØªØ§Ù†Ø§Øª! â€” Ø¥Ø±ÙŠÙ† ÙŠÙŠØºØ±",
  "Ø£Ù†Ø§ Ø§Ù„Ø£Ù‚ÙˆÙ‰ â€” ØºÙˆØ¬Ùˆ Ø³Ø§ØªÙˆØ±Ùˆ",
  "Ù„Ø§ ØªØ³ØªØ³Ù„Ù… Ø£Ø¨Ø¯Ø§Ù‹ â€” Ù†Ø§Ø±ÙˆØªÙˆ",
  "Ù„Ù† Ø£Ù…ÙˆØª Ø­ØªÙ‰ Ø£ØµØ¨Ø­ Ø£Ù‚ÙˆÙ‰ â€” Ø³ÙˆÙ†Øº Ø¬ÙŠÙ† ÙˆÙˆ",
  "Ø§Ù„Ø£Ù„Ù… Ù‡Ùˆ Ø·Ø±ÙŠÙ‚ Ø§Ù„Ù‚ÙˆØ© â€” Ù†Ø§ØºØ§ØªÙˆ",
  "Ø§Ù„Ù…ÙˆØª Ù„ÙŠØ³ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù…Ø·Ø§Ù â€” Ù…ÙŠÙ„ÙŠÙˆØ¯Ø§Ø³"
];

const topAnime = [
  "1. Solo Leveling - Ø³ÙˆÙ„Ùˆ Ù„ÙŠÙÙ„ÙŠÙ†Øº",
  "2. Jujutsu Kaisen - Ø¬ÙˆØ¬ÙˆØªØ³Ùˆ ÙƒØ§ÙŠØ³Ù†",
  "3. Demon Slayer - Ø¯ÙŠÙ…ÙˆÙ† Ø³Ù„Ø§ÙŠØ±",
  "4. Attack on Titan - Ù‡Ø¬ÙˆÙ… Ø§Ù„Ø¹Ù…Ø§Ù„Ù‚Ø©",
  "5. One Piece - ÙˆÙ† Ø¨ÙŠØ³",
  "6. Naruto Shippuden - Ù†Ø§Ø±ÙˆØªÙˆ Ø´ÙŠØ¨ÙˆØ¯Ù†",
  "7. Hunter x Hunter - Ù‡Ø§Ù†ØªØ± x Ù‡Ø§Ù†ØªØ±",
  "8. Death Note - Ø¯ÙŠØ« Ù†ÙˆØª",
  "9. Fullmetal Alchemist - Ø§Ù„Ø®ÙŠÙ…ÙŠØ§Ø¦ÙŠ Ø§Ù„ÙÙˆÙ„Ø§Ø°ÙŠ",
  "10. One Punch Man - ÙˆÙ† Ø¨Ø§Ù†Ø´ Ù…Ø§Ù†"
];

let handler = async (msgData) => {
  const { conn, m, args, sender, usedPrefix } = msgData;
  const action = args[0];
  
  try {
    // Ù…Ø¹Ù„ÙˆÙ…Ø© Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©
    if (action === 'Ù…Ø¹Ù„ÙˆÙ…Ø©' || action === 'fact') {
      const fact = animeFacts[Math.floor(Math.random() * animeFacts.length)];
      
      await conn.sendMessage(sender, { text: `â•­â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•®
â”ƒ  ğŸ§  *Ù…Ø¹Ù„ÙˆÙ…Ø© Ø£Ù†Ù…ÙŠ* ğŸ§ 
â•°â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•¯

âœ¨ ${fact}

ğŸ’¡ Ø§Ø³ØªØ®Ø¯Ù… \`.Ø§Ù†Ù…ÙŠ Ø§Ù‚ØªØ¨Ø§Ø³\` Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù‚ØªØ¨Ø§Ø³ Ù…Ø´Ù‡ÙˆØ±!` }, { quoted: m });
    }
    
    // Ø§Ù‚ØªØ¨Ø§Ø³ Ø¹Ø´ÙˆØ§Ø¦ÙŠ
    else if (action === 'Ø§Ù‚ØªØ¨Ø§Ø³' || action === 'quote') {
      const quote = animeQuotes[Math.floor(Math.random() * animeQuotes.length)];
      
      await conn.sendMessage(sender, { text: `â•­â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•®
â”ƒ  ğŸ’¬ *Ø§Ù‚ØªØ¨Ø§Ø³ Ø£Ù†Ù…ÙŠ* ğŸ’¬
â•°â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•¯

"${quote}"

âœ¨ Ø§Ø³ØªØ®Ø¯Ù… \`.Ø§Ù†Ù…ÙŠ ØªØ±ØªÙŠØ¨\` Ù„Ø£ÙØ¶Ù„ Ø§Ù„Ø£Ù†Ù…ÙŠØ§Øª!` }, { quoted: m });
    }
    
    // ØªØ±ØªÙŠØ¨ Ø£ÙØ¶Ù„ Ø§Ù„Ø£Ù†Ù…ÙŠØ§Øª
    else if (action === 'ØªØ±ØªÙŠØ¨' || action === 'top') {
      const list = topAnime.join('\n');
      
      await conn.sendMessage(sender, { text: `â•­â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•®
â”ƒ  ğŸ† *Ø£ÙØ¶Ù„ Ø§Ù„Ø£Ù†Ù…ÙŠØ§Øª* ğŸ†
â•°â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•¯

${list}

ğŸ¬ Ù‡Ø°Ø§ Ø§Ù„ØªØ±ØªÙŠØ¨ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª ÙˆØ§Ù„Ø´Ø¹Ø¨ÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©!` }, { quoted: m });
    }
    
    // ØªÙˆØµÙŠØ© Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©
    else if (action === 'ØªÙˆØµÙŠØ©' || action === 'recommend') {
      const recommendations = [
        "Solo Leveling - Ø¥Ø°Ø§ ÙƒÙ†Øª ØªØ­Ø¨ Ø§Ù„Ø£ÙƒØ´Ù† ÙˆØ§Ù„ØªØ·ÙˆØ± Ø§Ù„Ù‚ÙˆÙŠ",
        "Jujutsu Kaisen - Ù„Ù„Ø¬Ø±Ø§ÙÙŠÙƒØ³ Ø§Ù„Ø±Ø§Ø¦Ø¹ ÙˆØ§Ù„Ù‚ØªØ§Ù„Ø§Øª Ø§Ù„Ù…Ù„Ø­Ù…ÙŠØ©",
        "Demon Slayer - Ù„Ù„Ù‚ØµØ© Ø§Ù„Ø¹Ø§Ø·ÙÙŠØ© ÙˆØ§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ù…Ø°Ù‡Ù„Ø©",
        "One Piece - Ù„Ù„Ù…ØºØ§Ù…Ø±Ø© Ø§Ù„Ø·ÙˆÙŠÙ„Ø© ÙˆØ§Ù„Ø¹Ø§Ù„Ù… Ø§Ù„ÙˆØ§Ø³Ø¹",
        "Attack on Titan - Ù„Ù„Ù‚ØµØ© Ø§Ù„Ù…Ø¹Ù‚Ø¯Ø© ÙˆØ§Ù„ØªØ´ÙˆÙŠÙ‚",
        "Hunter x Hunter - Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù‚ÙˆÙ‰ Ø§Ù„ÙØ±ÙŠØ¯",
        "Death Note - Ù„Ù„Ø°ÙƒØ§Ø¡ ÙˆØ§Ù„ØªØ®Ø·ÙŠØ· Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠ",
        "Naruto - Ù„Ù„Ø´Ø®ØµÙŠØ§Øª Ø§Ù„Ù…Ø­Ø¨ÙˆØ¨Ø© ÙˆØ§Ù„Ù…Ø¹Ø§Ø±Ùƒ Ø§Ù„Ù…Ù„Ø­Ù…ÙŠØ©"
      ];
      
      const rec = recommendations[Math.floor(Math.random() * recommendations.length)];
      
      await conn.sendMessage(sender, { text: `â•­â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•®
â”ƒ  ğŸ¬ *ØªÙˆØµÙŠØ© Ø£Ù†Ù…ÙŠ* ğŸ¬
â•°â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•¯

ğŸ‘‰ ${rec}

ğŸ’¡ Ø§Ø³ØªØ®Ø¯Ù… \`.Ø§Ù†Ù…ÙŠ Ø¨Ø­Ø« (Ø§Ø³Ù…)\` Ù„Ù„Ø¨Ø­Ø« Ø¹Ù† Ø£Ù†Ù…ÙŠ Ù…Ø¹ÙŠÙ†!` }, { quoted: m });
    }
    
    // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø£Ù†Ù…ÙŠ
    else if (action === 'Ø¨Ø­Ø«' || action === 'search') {
      const animeName = args.slice(1).join(' ');
      
      if (!animeName) {
        return conn.sendMessage(sender, { text: `âŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ ÙƒØªØ§Ø¨Ø© Ø§Ø³Ù… Ø§Ù„Ø£Ù†Ù…ÙŠ!\n\nÙ…Ø«Ø§Ù„: \`.Ø§Ù†Ù…ÙŠ Ø¨Ø­Ø« Ù†Ø§Ø±ÙˆØªÙˆ\`` }, { quoted: m });
      }
      
      await conn.sendMessage(sender, { text: 'ğŸ” Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø«...' }, { quoted: m });
      
      // Ø§Ø³ØªØ®Ø¯Ø§Ù… API Ù…Ø¬Ø§Ù†ÙŠ Ù„Ù„Ø¨Ø­Ø«
      const url = `https://api.jikan.moe/v4/anime?q=${encodeURIComponent(animeName)}&limit=1`;
      const res = await axios.get(url);
      const data = res.data;
      
      if (!data.data || data.data.length === 0) {
        return conn.sendMessage(sender, { text: 'âŒ Ù„Ù… Ø£ØªÙ…ÙƒÙ† Ù…Ù† Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù†Ù…ÙŠ.' }, { quoted: m });
      }
      
      const anime = data.data[0];
      const synopsis = anime.synopsis ? anime.synopsis.substring(0, 300) + '...' : 'ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©';
      const genres = anime.genres && anime.genres.length > 0 
        ? anime.genres.map(g => g.name).join(', ') 
        : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
      
      let message = `â•­â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•®
â”ƒ  ğŸ¬ *${anime.title}* ğŸ¬
â•°â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•¯

ğŸ“– *Ø§Ù„Ù‚ØµØ©:*
${synopsis}

â•­â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•®
â”ƒ  ğŸ“Š Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª
â”ƒ  â­ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…: ${anime.score || 'ØºÙŠØ± Ù…ØªÙˆÙØ±'}
â”ƒ  ğŸ­ Ø§Ù„Ù†ÙˆØ¹: ${genres}
â”ƒ  ğŸ“… Ø§Ù„Ø³Ù†Ø©: ${anime.year || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}
â”ƒ  ğŸ“º Ø§Ù„Ø­Ù„Ù‚Ø§Øª: ${anime.episodes || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}
â•°â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•¯`;
      
      // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª
      await conn.sendMessage(sender, { text: message }, { quoted: m });
      
      // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØµÙˆØ±Ø© Ø¥Ù† ÙˆØ¬Ø¯Øª
      if (anime.images && anime.images.jpg && anime.images.jpg.image_url) {
        try {
          await conn.sendMessage(sender, {
            image: { url: anime.images.jpg.image_url },
            caption: `ğŸ¬ ${anime.title}`
          });
        } catch (e) {
          console.log('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØµÙˆØ±Ø©');
        }
      }
    }
    
    // Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
    else {
      await conn.sendMessage(sender, { text: `â•­â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•®
â”ƒ  ğŸ­ *Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø£Ù†Ù…ÙŠ* ğŸ­
â•°â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•¯

ğŸ“‹ *Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù…ØªØ§Ø­Ø©:*

\`.Ø§Ù†Ù…ÙŠ Ù…Ø¹Ù„ÙˆÙ…Ø©\`
â†³ Ù…Ø¹Ù„ÙˆÙ…Ø© Ø£Ù†Ù…ÙŠ Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©

\`.Ø§Ù†Ù…ÙŠ Ø§Ù‚ØªØ¨Ø§Ø³\`
â†³ Ø§Ù‚ØªØ¨Ø§Ø³ Ù…Ø´Ù‡ÙˆØ±

\`.Ø§Ù†Ù…ÙŠ ØªØ±ØªÙŠØ¨\`
â†³ Ø£ÙØ¶Ù„ 10 Ø£Ù†Ù…ÙŠØ§Øª

\`.Ø§Ù†Ù…ÙŠ ØªÙˆØµÙŠØ©\`
â†³ ØªÙˆØµÙŠØ© Ø£Ù†Ù…ÙŠ Ù…Ù†Ø§Ø³Ø¨Ø©

\`.Ø§Ù†Ù…ÙŠ Ø¨Ø­Ø« (Ø§Ø³Ù…)\`
â†³ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø£Ù†Ù…ÙŠ Ù…Ø¹ÙŠÙ†

Ù…Ø«Ø§Ù„: \`.Ø§Ù†Ù…ÙŠ Ø¨Ø­Ø« one piece\`` }, { quoted: m });
    }
    
  } catch (err) {
    console.error(err);
    await conn.sendMessage(sender, { text: 'âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªÙ†ÙÙŠØ° Ø§Ù„Ø£Ù…Ø±.' }, { quoted: m });
  }
}

handler.help = ['Ø§Ù†Ù…ÙŠ', 'anime'];
handler.tags = ['anime'];
handler.command = /^(Ø§Ù†Ù…ÙŠ|Ø£Ù†Ù…ÙŠ|anime)$/i;

module.exports = handler;
